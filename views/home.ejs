<h1><%= title %></h1>

<!-- ! Form to create Posts -->
<section id="feed-posts">
  <h3>Posts</h3>

  <!--* Restricting the forms visibility to only signed in users -->
  <% if(locals.user) { %>
  <form action="/posts/create" id="new-post-form" method="POST">
    <textarea
      name="content"
      cols="30"
      rows="3"
      placeholder="Type Here..."
      required
    ></textarea>

    <input class="btn" type="submit" value="Post" />
  </form>
  <% } %>

  <!-- using only "user" will give an error as user will not be defined if user
  is not signed in, but locals is an object which is always present so if no
  user is signed in "locals.user" will return false -->
</section>

<!-- ! List of Posts -->
<div id="posts-list-container">
  <ul>
    <% for (post of posts) { %>
    <li>
      <p>
        <%= post.content %>
        <br />
        <small> <%= post.user.name %></small>
      </p>

      <div class="post-comments">
        <% if(locals.user) { %>

        <!-- ! Form to create Comments -->
        <form action="/comments/create" method="POST">
          <input
            type="text"
            name="content"
            placeholder="Type here to add comment..."
            required
          />

          <!-- a hidden input field containing the id of the post in which the comment is being made -->
          <input type="hidden" name="post" value="<%= post._id %>" />

          <input type="submit" value="Add Comment" class="btn" />
        </form>

        <% } %>

        <!-- ! List of Comments -->
        <div class="post-comments-list">
          <ul id="post-comments-<%= post._id %>">
            <% for (comment of post.comments) { %>
            <p>
              <%= comment.content %>
              <br />
              <small> <%= comment.user.name %> </small>
            </p>
            <% } %>
          </ul>
        </div>
      </div>
    </li>
    <% } %>
  </ul>
</div>
